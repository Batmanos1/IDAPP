<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>IDAPP</title>
    <link rel="stylesheet" href="css/style.css"> 
</head>
<body>
    <div id="nebula-bg"></div>

    <div id="weather-widget">SCANNING...</div>

    <div id="edit-btn" onclick="openDesigner()">✎</div>

    <div id="app-container">
        <!-- PAGE 1: CONTROLS -->
        <div class="page" id="p1">
            <div class="header-area">
                <h1 id="app-title">IDAPP</h1>
                <div class="subtitle" id="app-type">UNIVERSAL CONTROLLER</div>
                <!-- Status is the primary button when offline -->
                <div id="status" onclick="connectBLE()">OFFLINE - TAP TO CONNECT</div>
                <div id="coin-box" style="display:none; color: gold; margin-top:5px;">COINS: <span id="val-coins">0</span></div>
            </div>

            <div class="visor-container">
                <!-- Visor is empty until JS populates it on connect -->
                <div class="visor" id="visor"></div>
                <div id="game-text" style="height:20px; margin-top:10px; font-size:12px; color:#fff;"></div>
            </div>

            <div class="controls">
                <div class="btn-round" id="btn-L" onpointerdown="btnDown(event, 'L')" onpointerup="btnUp(event, 'L')" onpointerleave="btnUp(event, 'L')" oncontextmenu="return false;">
                    <div class="btn-label">[ + ]</div>
                </div>
                
                <div class="btn-round menu-btn" onclick="openMenu()">
                    <span class="menu-lines"></span>
                    <span class="menu-lines"></span>
                    <span class="menu-lines"></span>
                </div>

                <div class="btn-round" id="btn-R" onpointerdown="btnDown(event, 'R')" onpointerup="btnUp(event, 'R')" onpointerleave="btnUp(event, 'R')" oncontextmenu="return false;">
                    <div class="btn-label">[ + ]</div>
                </div>
            </div>
            
            <div class="hint">SWIPE UP FOR VITALS</div>
        </div>

        <!-- PAGE 2: VITALS -->
        <div class="page" id="p2" style="background: transparent;">
            <div class="hint" style="margin-top:20px; transform: rotate(180deg);">SWIPE DOWN FOR CONTROLS</div>
            <div class="stats-content">
                <div class="subtitle">BIOMETRIC DATA</div>
                <h3>SYSTEM VITALS</h3>
                <div class="bar-container">
                    <div class="label"><span>HAPPINESS</span> <span id="val-hap">50%</span></div>
                    <div class="progress-bg"><div class="progress-fill" id="bar-hap" style="width: 50%"></div></div>
                </div>
                <div class="bar-container">
                    <div class="label"><span>HUNGER</span> <span>80%</span></div>
                    <div class="progress-bg"><div class="progress-fill" style="background: #ff0055; width: 80%"></div></div>
                </div>
                <div class="bar-container">
                    <div class="label"><span>ENERGY</span> <span id="val-eng">10%</span></div>
                    <div class="progress-bg"><div class="progress-fill" style="background: #ffaa00; width: 10%" id="bar-eng"></div></div>
                </div>
            </div>
            <div style="flex-grow:1"></div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="designerModal">
        <div class="designer-panel">
            <div class="designer-header">
                <span style="letter-spacing:2px; font-size:12px; color:#fff;">OPTIC DESIGNER</span>
                <span class="close-btn" onclick="closeDesigner()">×</span>
            </div>
            
            <div class="preview-area">
                <div class="visor preview-visor" id="preview-visor"></div>
            </div>

            <div class="tools-container">
                <div class="preset-row">
                    <button class="tool-btn" onclick="loadPreset('incy')">STD</button>
                    <button class="tool-btn" onclick="loadPreset('glitch')">GLITCH</button>
                    <button class="tool-btn" onclick="loadPreset('weaver')">WEAVER</button>
                    <button class="tool-btn" onclick="loadPreset('cyclops')">CYCLOPS</button>
                </div>

                <div style="display:flex; justify-content:space-between; margin:5px 0;">
                    <button class="tool-btn" onclick="addEye()" style="flex:0 0 auto; width:100px;">+ NEW EYE</button>
                    <label style="font-size:10px; display:flex; align-items:center; gap:5px; color:#888;">
                        <input type="checkbox" id="mirror-check" checked> MIRROR
                    </label>
                </div>

                <div class="selection-row" id="eye-selector"></div>

                <div class="sliders-area" id="controls-area">
                    <div class="slider-group">
                        <label>WIDTH <span id="val-w">30</span></label>
                        <input type="range" id="inp-w" min="5" max="60" oninput="updateEyeParam('w', this.value)">
                    </div>
                    <div class="slider-group">
                        <label>HEIGHT <span id="val-h">30</span></label>
                        <input type="range" id="inp-h" min="5" max="60" oninput="updateEyeParam('h', this.value)">
                    </div>
                    <div class="slider-group">
                        <label>ROUNDNESS <span id="val-r">50</span></label>
                        <input type="range" id="inp-r" min="0" max="50" oninput="updateEyeParam('r', this.value)">
                    </div>
                    <div class="slider-group">
                        <label>POS X <span id="val-x">0</span></label>
                        <input type="range" id="inp-x" min="-60" max="60" oninput="updateEyeParam('x', this.value)">
                    </div>
                    <div class="slider-group">
                        <label>POS Y <span id="val-y">0</span></label>
                        <input type="range" id="inp-y" min="-30" max="30" oninput="updateEyeParam('y', this.value)">
                    </div>
                </div>
            </div>

            <div class="action-row">
                <button class="big-btn del-btn" onclick="deleteSelectedEye()">DELETE</button>
                <button class="big-btn save-btn" onclick="saveAndUpload()">UPLOAD</button>
            </div>
        </div>
    </div>

    <div id="menuModal">
        <div class="menu-content">
            <div class="menu-title">COMMAND PROTOCOLS</div>
            <div class="menu-option" onclick="startGame('1')">MEMORY GAME <span id="hs-mem">HS: -</span></div>
            <div class="menu-option" onclick="startGame('2')">REFLEX GAME <span id="hs-ref">HS: -</span></div>
            <div class="menu-option" onclick="startGame('3')">SLOT MACHINE <span id="hs-slot">STRK: -</span></div>
            <div class="menu-option" onclick="send('F')" style="border-color: #ffaa00; color: #ffaa00;">FEED ROBOT <span>10 COINS</span></div>
            <div class="menu-option" onclick="stopGame()" style="background:rgba(255,0,0,0.1); border-color: #500;">TERMINATE ACTIVITY</div>
            <div class="menu-option" style="justify-content: center; margin-top:20px; border:none; background:transparent;">
                <label style="font-size:12px; color:#888; display:flex; align-items:center; gap:10px;">
                    MUTE SOUND <input type="checkbox" onchange="send('V')">
                </label>
            </div>
            <div class="close-menu" onclick="closeMenu()">×</div>
        </div>
    </div>

    <script src="js/script.js"></script>
</body>
</html>
